/*
 * Components - Forms
 * 
 * Enhanced form component styles building on base form styles
 * Includes form groups, input groups, and advanced form patterns
 */

// Form group enhancements
.form-group {
    position: relative;
    margin-bottom: $form-group-margin-bottom;

    // Floating labels
    &.form-floating {
        position: relative;

        .form-control,
        .form-select {
            height: calc(3.5rem + 2px);
            padding: 1rem 0.75rem 0.25rem;

            &:focus,
            &:not(:placeholder-shown) {
                ~.form-label {
                    opacity: 0.65;
                    transform: scale(0.85) translateY(-0.5rem) translateX(0.15rem);
                }
            }
        }

        .form-label {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            padding: 1rem 0.75rem;
            pointer-events: none;
            border: 1px solid transparent;
            transform-origin: 0 0;
            transition: opacity 0.1s ease-in-out, transform 0.1s ease-in-out;
        }
    }

    // Required field indicator
    &.required {
        .form-label::after {
            content: " *";
            color: $danger;
        }
    }
}

// Input groups
.input-group {
    position: relative;
    display: flex;
    flex-wrap: wrap;
    align-items: stretch;
    width: 100%;

    .form-control,
    .form-select {
        position: relative;
        flex: 1 1 auto;
        width: 1%;
        min-width: 0;
    }

    .form-control:not(:first-child),
    .form-select:not(:first-child) {
        margin-left: -1px;
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }

    .form-control:not(:last-child),
    .form-select:not(:last-child) {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }
}

// Input group text (prepend/append)
.input-group-text {
    display: flex;
    align-items: center;
    padding: $input-padding-y $input-padding-x;
    font-size: $font-size-base;
    font-weight: $font-weight-normal;
    line-height: $line-height-normal;
    color: $text-secondary;
    text-align: center;
    white-space: nowrap;
    background-color: $gray-100;
    border: 1px solid $border-color;
    border-radius: $input-border-radius;

    .input-group:not(.has-validation)> :not(:last-child):not(.dropdown-toggle):not(.dropdown-menu) &,
    .input-group:not(.has-validation)>.dropdown-toggle:nth-last-child(n + 3) & {
        border-top-right-radius: 0;
        border-bottom-right-radius: 0;
    }

    .input-group> :not(:first-child):not(.dropdown-menu):not(.valid-tooltip):not(.valid-feedback):not(.invalid-tooltip):not(.invalid-feedback) & {
        border-top-left-radius: 0;
        border-bottom-left-radius: 0;
    }
}

// Form control sizing
.form-control-sm,
.form-select-sm {
    min-height: calc(1.5em + #{$component-padding-sm} + #{$border-width-1 * 2});
    padding: $component-padding-sm;
    font-size: $font-size-sm;
    border-radius: $border-radius-sm;
}

.form-control-lg,
.form-select-lg {
    min-height: calc(1.5em + #{$component-padding-lg} + #{$border-width-1 * 2});
    padding: $component-padding-lg;
    font-size: $font-size-lg;
    border-radius: $border-radius-md;
}

// Form validation enhancements
.was-validated {

    .form-control:valid,
    .form-select:valid {
        border-color: $color-valid;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 8 8'%3e%3cpath fill='%23198754' d='m2.3 6.73.8-.77-.76-.77-.76.77.76.77z'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);

        &:focus {
            border-color: $color-valid;
            box-shadow: $focus-shadow-success;
        }
    }

    .form-control:invalid,
    .form-select:invalid {
        border-color: $color-invalid;
        padding-right: calc(1.5em + 0.75rem);
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 12 12' width='12' height='12' fill='none' stroke='%23dc3545'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 4.6 2.4 2.4m0-2.4L5.8 7'/%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right calc(0.375em + 0.1875rem) center;
        background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem);

        &:focus {
            border-color: $color-invalid;
            box-shadow: $focus-shadow-danger;
        }
    }
}

// Form check enhancements (checkboxes and radios)
.form-check {
    .form-check-input {
        width: 1em;
        height: 1em;
        margin-top: 0.25em;
        vertical-align: top;
        background-color: $white;
        background-repeat: no-repeat;
        background-position: center;
        background-size: contain;
        border: 1px solid $border-color;
        appearance: none;
        color-adjust: exact;

        &[type="checkbox"] {
            border-radius: $border-radius-sm;
        }

        &[type="radio"] {
            border-radius: 50%;
        }

        &:active {
            filter: brightness(90%);
        }

        &:focus {
            border-color: $color-focus;
            outline: 0;
            box-shadow: $focus-shadow-primary;
        }

        &:checked {
            background-color: $primary;
            border-color: $primary;

            &[type="checkbox"] {
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='m6 10 3 3 6-6'/%3e%3c/svg%3e");
            }

            &[type="radio"] {
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='2' fill='%23fff'/%3e%3c/svg%3e");
            }
        }

        &:disabled {
            pointer-events: none;
            filter: none;
            opacity: 0.5;
        }

        &[disabled]~.form-check-label,
        &:disabled~.form-check-label {
            opacity: 0.5;
        }
    }

    // Switch variant
    &.form-switch {
        padding-left: 2.5em;

        .form-check-input {
            width: 2em;
            margin-left: -2.5em;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='rgba%280, 0, 0, 0.25%29'/%3e%3c/svg%3e");
            background-position: left center;
            border-radius: 2em;
            transition: background-position 0.15s ease-in-out;

            &:focus {
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%2300b4e3'/%3e%3c/svg%3e");
            }

            &:checked {
                background-position: right center;
                background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='-4 -4 8 8'%3e%3ccircle r='3' fill='%23fff'/%3e%3c/svg%3e");
            }
        }
    }
}

// Range inputs
.form-range {
    width: 100%;
    height: 1.5rem;
    padding: 0;
    background-color: transparent;
    appearance: none;

    &:focus {
        outline: 0;

        &::-webkit-slider-thumb {
            box-shadow: 0 0 0 1px $white, $focus-shadow-primary;
        }

        &::-moz-range-thumb {
            box-shadow: 0 0 0 1px $white, $focus-shadow-primary;
        }
    }

    &::-webkit-slider-track {
        width: 100%;
        height: 0.5rem;
        color: transparent;
        cursor: pointer;
        background-color: $gray-200;
        border-color: transparent;
        border-radius: 1rem;
    }

    &::-webkit-slider-thumb {
        width: 1rem;
        height: 1rem;
        margin-top: -0.25rem;
        background-color: $primary;
        border: 0;
        border-radius: 1rem;
        transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        appearance: none;

        &:active {
            background-color: lighten($primary, 35%);
        }
    }

    &::-moz-range-track {
        width: 100%;
        height: 0.5rem;
        color: transparent;
        cursor: pointer;
        background-color: $gray-200;
        border-color: transparent;
        border-radius: 1rem;
    }

    &::-moz-range-thumb {
        width: 1rem;
        height: 1rem;
        background-color: $primary;
        border: 0;
        border-radius: 1rem;
        transition: background-color 0.15s ease-in-out, border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
        appearance: none;

        &:active {
            background-color: lighten($primary, 35%);
        }
    }

    &:disabled {
        pointer-events: none;

        &::-webkit-slider-thumb {
            background-color: $gray-400;
        }

        &::-moz-range-thumb {
            background-color: $gray-400;
        }
    }
}

// File input
.form-control[type="file"] {
    overflow: hidden;

    &:not(:disabled):not([readonly]) {
        cursor: pointer;
    }
}

// Form layout patterns
.form-row {
    display: flex;
    flex-wrap: wrap;
    margin-right: -5px;
    margin-left: -5px;

    >.col,
    >[class*="col-"] {
        padding-right: 5px;
        padding-left: 5px;
    }
}

// Inline forms
.form-inline {
    display: flex;
    flex-flow: row wrap;
    align-items: center;

    .form-check {
        width: 100%;
    }

    @media (min-width: 576px) {
        label {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 0;
        }

        .form-group {
            display: flex;
            flex: 0 0 auto;
            flex-flow: row wrap;
            align-items: center;
            margin-bottom: 0;
        }

        .form-control {
            display: inline-block;
            width: auto;
            vertical-align: middle;
        }

        .form-control-plaintext {
            display: inline-block;
        }

        .input-group,
        .custom-select {
            width: auto;
        }

        .form-check {
            display: flex;
            align-items: center;
            justify-content: center;
            width: auto;
            padding-left: 0;
        }

        .form-check-input {
            position: relative;
            flex-shrink: 0;
            margin-top: 0;
            margin-right: 0.25rem;
            margin-left: 0;
        }

        .custom-control {
            align-items: center;
            justify-content: center;
        }

        .custom-control-label {
            margin-bottom: 0;
        }
    }
}