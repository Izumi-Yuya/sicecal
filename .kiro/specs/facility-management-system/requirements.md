# Requirements Document

## Introduction

施設カルテシステム（Shise-Cal）は、現在紙やExcelで個別管理されている施設情報を一元管理するシステムです。権限管理と承認機能により、業務効率と情報の整合性向上を目的としています。

## Requirements

### Requirement 1: ユーザー認証とロール管理

**User Story:** システム管理者として、ユーザーアカウントとロールを管理したい。組織の責任に基づいて施設情報へのアクセスを制御するため。

#### Acceptance Criteria

1. WHEN システム管理者が新しいユーザーアカウントを作成する時、THEN システムはメールアドレスとパスワードを必須とする
2. WHEN ユーザーがログインを試行する時、THEN システムはメールアドレスとパスワードで認証を行う
3. WHEN 承認されたIPアドレス以外からアクセスが試行された時、THEN システムはアクセスを拒否する
4. IF ユーザーがシステム管理者ロールを持つ場合、THEN システムはユーザー登録、削除、ロール割り当てを許可する
5. WHEN ユーザーにロールが割り当てられた時、THEN システムはロールベースのアクセス権限を適用する

### Requirement 2: 施設情報管理

**User Story:** 編集者として、施設情報の登録、更新、削除を行いたい。施設データを最新かつ正確に保つため。

#### Acceptance Criteria

1. WHEN 編集者が新しい施設を作成する時、THEN システムは施設名を必須とする
2. WHEN 施設情報が更新される時、THEN システムは承認ワークフローに変更を記録する
3. WHEN 施設が削除される時、THEN システムは永続的な削除前に承認を必要とする
4. IF 施設名が既に存在する場合、THEN システムは重複登録を防止する
5. WHEN 郵便番号が入力される時、THEN システムはハイフンなしの7桁形式を検証する

### Requirement 3: ドキュメント・ファイル管理

**User Story:** 編集者として、施設のPDFドキュメントをアップロード・管理したい。契約書や図面などの重要書類を一元保管するため。

#### Acceptance Criteria

1. WHEN 編集者がPDFファイルをアップロードする時、THEN システムは特定の施設に関連付ける
2. WHEN PDFがアップロードされる時、THEN システムは必要な3年間の保管期間で保存する
3. WHEN 認証されたユーザーがドキュメントにアクセスする時、THEN システムはユーザー権限に基づいてPDFダウンロードを許可する
4. IF ファイルアップロードが失敗した場合、THEN システムは適切なエラーメッセージを表示する
5. WHEN ドキュメントが更新される時、THEN システムはバージョン履歴を維持する

### Requirement 4: 承認ワークフロー

**User Story:** 承認者として、施設情報の変更を確認・承認したい。適切な監督によりデータの正確性を維持するため。

#### Acceptance Criteria

1. WHEN 編集者が変更を申請する時、THEN システムは指定された承認者に通知する
2. WHEN 承認者が変更を確認する時、THEN システムはコメント付きで承認または却下を許可する
3. IF 変更が却下された場合、THEN システムは却下コメントと共に編集者に返却する
4. WHEN 変更が承認される時、THEN システムは施設情報を更新する
5. WHEN 承認アクションが発生する時、THEN システムは全ての承認履歴をログに記録する

### Requirement 5: ロールベースアクセス制御

**User Story:** 特定のロール権限を持つユーザーとして、自分のロールに適した情報と機能のみにアクセスしたい。データセキュリティと組織境界を維持するため。

#### Acceptance Criteria

1. IF ユーザーが「システム管理者」ロールを持つ場合、THEN システムは全施設と管理機能へのアクセスを許可する
2. IF ユーザーが「編集者」ロールを持つ場合、THEN システムは全施設情報の編集を許可する
3. IF ユーザーが「承認者」ロールを持つ場合、THEN システムは全施設の変更承認を許可する
4. IF ユーザーが「閲覧者（役員・本社）」ロールを持つ場合、THEN システムはCSV/PDF出力付きで全施設の閲覧を許可する
5. IF ユーザーが「閲覧者（部門責任者）」ロールを持つ場合、THEN システムはCSV/PDF出力付きで部門施設のみの閲覧を許可する
6. IF ユーザーが「閲覧者（地区担当）」ロールを持つ場合、THEN システムはCSV/PDF出力付きで割り当てられた地区施設のみの閲覧を許可する
7. IF ユーザーが「閲覧者（事業所）」ロールを持つ場合、THEN システムは自施設情報のみの閲覧を許可する

### Requirement 6: データ出力・レポート機能

**User Story:** 閲覧者として、施設データをCSVとPDF形式で出力したい。レポートと分析目的で情報を活用するため。

#### Acceptance Criteria

1. WHEN ユーザーがCSVデータを出力する時、THEN システムはUTF-8 with BOM形式で出力する
2. WHEN ユーザーがPDFレポートを作成する時、THEN システムは承認済み情報のみを含める
3. WHEN ユーザーが出力設定を保存する時、THEN システムはユーザーあたり最大10件のお気に入り出力設定を許可する
4. IF ユーザーが出力権限を持たない場合、THEN システムは出力機能を拒否する
5. WHEN 出力が実行される時、THEN システムは出力アクションをログに記録する

### Requirement 7: 修繕履歴管理

**User Story:** 編集者として、施設の修繕履歴を記録・追跡したい。修繕パターンと将来のニーズを分析するため。

#### Acceptance Criteria

1. WHEN 修繕が実施される時、THEN システムは日付、説明、詳細の記録を許可する
2. WHEN 修繕履歴を閲覧する時、THEN システムは全ての修繕活動の時系列リストを表示する
3. WHEN 修繕記録が作成される時、THEN システムは特定の施設に関連付ける
4. IF 修繕データが不完全な場合、THEN システムは保存前に必須フィールドを要求する
5. WHEN 修繕履歴にアクセスする時、THEN システムはユーザーロール権限を尊重する

### Requirement 8: 年次情報確認

**User Story:** 施設管理者として、年次で施設情報の正確性を確認したい。データ整合性を維持し、監査要件を満たすため。

#### Acceptance Criteria

1. WHEN 年次確認期間が到来する時、THEN システムは施設管理者に通知する
2. WHEN 施設管理者が情報を確認する時、THEN システムは確認または相違報告を許可する
3. IF 相違が報告された場合、THEN システムは修正のため編集者に通知する
4. WHEN 確認が完了する時、THEN システムは確認アクションをログに記録する
5. WHEN 確認回答が受信される時、THEN システムは完了ステータスを追跡する

### Requirement 9: コメント・通知システム

**User Story:** 閲覧者として、施設情報の相違についてコメントを送信したい。データ正確性の問題を特定し修正するため。

#### Acceptance Criteria

1. WHEN 閲覧者が情報の相違を特定する時、THEN システムはコメント送信を許可する
2. WHEN コメントが送信される時、THEN システムは一次対応編集者に通知する
3. WHEN 編集者がコメント通知を受信する時、THEN システムは回答とステータス更新を許可する
4. IF コメントがフォローアップを必要とする場合、THEN システムは解決ステータスを追跡する
5. WHEN コメント解決が発生する時、THEN システムは元のコメント投稿者に通知する

### Requirement 10: システムログ・監査証跡

**User Story:** システム管理者として、全てのシステム活動を追跡したい。監査要件を満たし、システム使用状況を監視するため。

#### Acceptance Criteria

1. WHEN 任意のユーザーがアクションを実行する時、THEN システムはユーザーID、タイムスタンプ、アクション詳細をログに記録する
2. WHEN 管理者がログを確認する時、THEN システムは検索可能な監査証跡を提供する
3. WHEN データが出力される時、THEN システムは追跡のため出力アクションをログに記録する
4. IF 疑わしい活動が発生した場合、THEN システムは詳細な活動記録を維持する
5. WHEN ログデータにアクセスする時、THEN システムは認証された管理者のみにアクセスを制限する
### Requirement 11: 契約・保険期限管理

**User Story:** 管理者として、契約や保険の期限を事前に把握したい。更新漏れを防止し、適切な契約管理を行うため。

#### Acceptance Criteria

1. WHEN 賃貸借契約終了日が近づく時、THEN システムは事前に関係者に通知する
2. WHEN 火災保険・地震保険の期限が近づく時、THEN システムは更新リマインダーを送信する
3. WHEN 契約期限一覧を表示する時、THEN システムは期限順でソートされた一覧を提供する
4. IF 期限切れの契約がある場合、THEN システムはダッシュボードで警告表示を行う
5. WHEN 契約更新が完了した時、THEN システムは新しい契約期間を記録し、通知を停止する

