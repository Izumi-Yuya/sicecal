# 要件定義書

## はじめに

施設カルテシステム（Shise-Cal）は、現在紙やExcelで個別管理されている施設情報を一元管理するシステムです。権限管理と承認機能により、業務効率と情報の整合性向上を目的としています。

## 要件

### 要件1: ユーザー認証とロール管理

**ユーザーストーリー:** システム管理者として、ユーザーアカウントとロールを管理したい。組織の責任に基づいて施設情報へのアクセスを制御するため。

#### 受入基準

1. システム管理者が新しいユーザーアカウントを作成する時、システムはメールアドレスとパスワードを必須とする
2. ユーザーがログインを試行する時、システムはメールアドレスとパスワードで認証を行う
3. 承認されたIPアドレス以外からアクセスが試行された時、システムはアクセスを拒否する
4. ユーザーがシステム管理者ロールを持つ場合、システムはユーザー登録、削除、ロール割り当てを許可する
5. ユーザーにロールが割り当てられた時、システムはロールベースのアクセス権限を適用する

### 要件2: 施設情報管理

**ユーザーストーリー:** 編集者として、施設情報の登録、更新、削除を行いたい。施設データを最新かつ正確に保つため。

#### 受入基準

1. 編集者が新しい施設を作成する時、システムは施設名、郵便番号、開設年月日を必須とする
2. 施設情報が更新される時、システムは承認ワークフローに変更を記録する
3. 施設が削除される時、システムは永続的な削除前に承認を必要とする
4. 施設名が既に存在する場合、システムは重複登録を防止する
5. 郵便番号が入力される時、システムはハイフンなしの7桁形式を検証する

### 要件3: ドキュメント・ファイル管理

**ユーザーストーリー:** 編集者として、施設のPDFドキュメントをアップロード・管理したい。契約書や図面などの重要書類を一元保管するため。

#### 受入基準

1. 編集者がPDFファイルをアップロードする時、システムは特定の施設に関連付ける
2. PDFがアップロードされる時、システムは必要な3年間の保管期間で保存する
3. 認証されたユーザーがドキュメントにアクセスする時、システムはユーザー権限に基づいてPDFダウンロードを許可する
4. ファイルアップロードが失敗した場合、システムは適切なエラーメッセージを表示する
5. ドキュメントが更新される時、システムはバージョン履歴を維持する

### 要件4: 承認ワークフロー

**ユーザーストーリー:** 承認者として、施設情報の変更を確認・承認したい。適切な監督によりデータの正確性を維持するため。

#### 受入基準

1. 編集者が変更を申請する時、システムは指定された承認者に通知する
2. 承認者が変更を確認する時、システムはコメント付きで承認または却下を許可する
3. 変更が却下された場合、システムは却下コメントと共に編集者に返却する
4. 変更が承認される時、システムは施設情報を更新する
5. 承認アクションが発生する時、システムは全ての承認履歴をログに記録する

### 要件5: ロールベースアクセス制御

**ユーザーストーリー:** 特定のロール権限を持つユーザーとして、自分のロールに適した情報と機能のみにアクセスしたい。データセキュリティと組織境界を維持するため。

#### 受入基準

1. ユーザーが「システム管理者」ロールを持つ場合、システムは全施設と管理機能へのアクセスを許可する
2. ユーザーが「編集者」ロールを持つ場合、システムは全施設情報の編集を許可する
3. ユーザーが「承認者」ロールを持つ場合、システムは全施設の変更承認を許可する
4. ユーザーが「閲覧者（役員・本社）」ロールを持つ場合、システムはCSV/PDF出力付きで全施設の閲覧を許可する
5. ユーザーが「閲覧者（部門責任者）」ロールを持つ場合、システムは部門施設のみの閲覧を許可する
6. ユーザーが「閲覧者（地区担当）」ロールを持つ場合、システムは割り当てられた地区施設のみの閲覧を許可する
7. ユーザーが「閲覧者（事業所）」ロールを持つ場合、システムは自施設情報のみの閲覧を許可する

### 要件6: データ出力・レポート機能

**ユーザーストーリー:** 閲覧者として、施設データをCSVとPDF形式で出力したい。レポートと分析目的で情報を活用するため。

#### 受入基準

1. ユーザーがCSVデータを出力する時、システムはUTF-8 with BOM形式で出力する
2. ユーザーがPDFレポートを作成する時、システムは承認済み情報のみを含める
3. ユーザーが出力設定を保存する時、システムはユーザーあたり最大10件のお気に入り出力設定を許可する
4. ユーザーが出力権限を持たない場合、システムは出力機能を拒否する
5. 出力が実行される時、システムは出力アクションをログに記録する

### 要件7: 修繕履歴管理

**ユーザーストーリー:** 編集者として、施設の修繕履歴を記録・追跡したい。修繕パターンと将来のニーズを分析するため。

#### 受入基準

1. 修繕が実施される時、システムは日付、説明、詳細の記録を許可する
2. 修繕履歴を閲覧する時、システムは全ての修繕活動の時系列リストを表示する
3. 修繕記録が作成される時、システムは特定の施設に関連付ける
4. 修繕データが不完全な場合、システムは保存前に必須フィールドを要求する
5. 修繕履歴にアクセスする時、システムはユーザーロール権限を尊重する

### 要件8: 年次情報確認

**ユーザーストーリー:** 施設管理者として、年次で施設情報の正確性を確認したい。データ整合性を維持し、監査要件を満たすため。

#### 受入基準

1. 年次確認期間が到来する時、システムは施設管理者に通知する
2. 施設管理者が情報を確認する時、システムは確認または相違報告を許可する
3. 相違が報告された場合、システムは修正のため編集者に通知する
4. 確認が完了する時、システムは確認アクションをログに記録する
5. 確認回答が受信される時、システムは完了ステータスを追跡する

### 要件9: コメント・通知システム

**ユーザーストーリー:** 閲覧者として、施設情報の相違についてコメントを送信したい。データ正確性の問題を特定し修正するため。

#### 受入基準

1. 閲覧者が情報の相違を特定する時、システムはコメント送信を許可する
2. コメントが送信される時、システムは一次対応編集者に通知する
3. 編集者がコメント通知を受信する時、システムは回答とステータス更新を許可する
4. コメントがフォローアップを必要とする場合、システムは解決ステータスを追跡する
5. コメント解決が発生する時、システムは元のコメント投稿者に通知する

### 要件10: システムログ・監査証跡

**ユーザーストーリー:** システム管理者として、全てのシステム活動を追跡したい。監査要件を満たし、システム使用状況を監視するため。

#### 受入基準

1. 任意のユーザーがアクションを実行する時、システムはユーザーID、タイムスタンプ、アクション詳細をログに記録する
2. 管理者がログを確認する時、システムは検索可能な監査証跡を提供する
3. データが出力される時、システムは追跡のため出力アクションをログに記録する
4. 疑わしい活動が発生した場合、システムは詳細な活動記録を維持する
5. ログデータにアクセスする時、システムは認証された管理者のみにアクセスを制限する
###
 要件11: 定例会・会議サポート機能

**ユーザーストーリー:** 管理者として、定例会で使用する施設情報レポートを効率的に作成したい。会議での意思決定を支援するため。

#### 受入基準

1. 定例会開催前に、システムは関連する施設情報レポートの生成を許可する
2. 会議用レポートが生成される時、システムは承認済み情報のみを含める
3. 定例会で決定された事項が入力される時、システムは決定事項を施設情報に反映する機能を提供する
4. 会議議事録に関連する施設がある場合、システムは該当施設への参照リンクを提供する
5. 定例会スケジュールが設定される時、システムは関係者に事前通知を送信する

### 要件12: 契約・保険期限管理

**ユーザーストーリー:** 管理者として、契約や保険の期限を事前に把握したい。更新漏れを防止し、適切な契約管理を行うため。

#### 受入基準

1. 賃貸借契約終了日が近づく時、システムは事前に関係者に通知する
2. 火災保険・地震保険の期限が近づく時、システムは更新リマインダーを送信する
3. 契約期限一覧を表示する時、システムは期限順でソートされた一覧を提供する
4. 期限切れの契約がある場合、システムはダッシュボードで警告表示を行う
5. 契約更新が完了した時、システムは新しい契約期間を記録し、通知を停止する

### 要件13: 施設稼働状況・利用状況管理

**ユーザーストーリー:** 部門責任者として、施設の稼働状況や利用状況を把握したい。効率的な施設運営と計画策定のため。

#### 受入基準

1. 施設の定員と実際の利用者数が入力される時、システムは稼働率を自動計算する
2. 月次・年次の稼働率レポートが要求される時、システムは期間指定でのレポート生成を許可する
3. 稼働率が基準値を下回る時、システムは関係者に通知を送信する
4. 施設別稼働率比較が必要な時、システムは地区・部門単位での比較レポートを提供する
5. 稼働状況データが更新される時、システムは承認ワークフローを適用する